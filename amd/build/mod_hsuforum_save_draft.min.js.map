{"version":3,"sources":["../src/mod_hsuforum_save_draft.js"],"names":["define","autoSave","forumid","discussionid","postid","text","userid","$","ajax","url","method","data","dataType","success","fetchAutoSave","window","drafttext","init","timer","pageloadclick","on","parent","closest","attr","setTimeout","find","html","not","e","hasOwnProperty","preventDefault","document","clearTimeout"],"mappings":"AAAAA,OAAM,wCAAC,EAAD,CAAK,UAAW,CASlB,QAASC,CAAAA,CAAT,CAAkBC,CAAlB,CAA2BC,CAA3B,CAAyCC,CAAzC,CAAiDC,CAAjD,CAAuDC,CAAvD,CAA+D,CAC3D,GAAI,CAAY,EAAX,EAAAJ,CAAO,EAA0B,EAAhB,EAAAC,CAAlB,GAAiD,EAAR,EAAAE,CAAzC,EAAiE,EAAV,EAAAC,CAA3D,CAAyE,CACrEC,CAAC,CAACC,IAAF,CAAO,CACHC,GAAG,CAAE,qBADF,CAEHC,MAAM,CAAE,MAFL,CAGHC,IAAI,CAAE,CACFT,OAAO,CAAEA,CADP,CAEFC,YAAY,CAAEA,CAFZ,CAGFC,MAAM,CAAEA,CAHN,CAIFC,IAAI,CAAEA,CAJJ,CAKFC,MAAM,CAAEA,CALN,CAHH,CAUHM,QAAQ,CAAE,MAVP,CAWHC,OAAO,CAAE,kBAAW,CAEnB,CAbE,CAAP,CAeH,CACJ,CASD,QAASC,CAAAA,CAAT,CAAuBZ,CAAvB,CAAgCC,CAAhC,CAA8CC,CAA9C,CAAsDE,CAAtD,CAA8D,CAC1D,GAAI,CAAY,EAAX,EAAAJ,CAAO,EAA0B,EAAhB,EAAAC,CAAjB,EAAiD,EAAV,EAAAC,CAAxC,GAAmE,EAAV,EAAAE,CAA7D,CAA2E,CACvEC,CAAC,CAACC,IAAF,CAAO,CACHC,GAAG,CAAE,oBADF,CAEHC,MAAM,CAAE,KAFL,CAGHC,IAAI,CAAE,CACFT,OAAO,CAAEA,CADP,CAEFC,YAAY,CAAEA,CAFZ,CAGFC,MAAM,CAAEA,CAHN,CAIFE,MAAM,CAAEA,CAJN,CAHH,CASHM,QAAQ,CAAE,MATP,CAUHC,OAAO,CAAE,iBAASF,CAAT,CAAe,CACpBI,MAAM,CAACC,SAAP,CAAmBL,CACtB,CAZE,CAAP,CAcH,CACJ,CAED,MAAO,CACHM,IAAI,CAAE,cAASf,CAAT,CAAkBC,CAAlB,CAAgCG,CAAhC,CAAwC,CAC1CC,CAAC,CAAC,UAAW,IACLW,CAAAA,CADK,CAGLC,CAAa,GAHR,CAMTZ,CAAC,CAAC,sBAAD,CAAD,CAA0Ba,EAA1B,CAA6B,OAA7B,CAAsC,UAAW,CAC7CL,MAAM,CAACC,SAAP,CAAmB,EAAnB,CAD6C,GAGzCK,CAAAA,CAAM,CAAGd,CAAC,CAAC,IAAD,CAAD,CAAQe,OAAR,CAAgB,wBAAhB,CAHgC,CAIzClB,CAAM,CAAGG,CAAC,CAACc,CAAD,CAAD,CAAUE,IAAV,CAAe,aAAf,CAJgC,CAM7CT,CAAa,CAACZ,CAAD,CAAUC,CAAV,CAAwBC,CAAxB,CAAgCE,CAAhC,CAAb,CAEAkB,UAAU,CAAC,UAAW,CAClBjB,CAAC,CAACc,CAAD,CAAD,CAAUI,IAAV,CAAe,+BAAf,EAAgDC,IAAhD,CAAqDX,MAAM,CAACC,SAA5D,CACH,CAFS,CAEP,GAFO,CAGb,CAXD,EAaAT,CAAC,CAAC,+CAAD,CAAD,CAAmDoB,GAAnD,CAAuD,qBAAvD,EAA8EP,EAA9E,CAAiF,OAAjF,CAA0F,SAASQ,CAAT,CAAY,CAIlG,GAAI,CAACA,CAAC,CAACC,cAAF,CAAiB,eAAjB,CAAD,EAAsCV,CAA1C,CAAyD,CACrDS,CAAC,CAACE,cAAF,GACA,QACH,CAEDf,MAAM,CAACC,SAAP,CAAmB,EAAnB,CAEAG,CAAa,GAAb,CAEAL,CAAa,CAACZ,CAAD,CAAUC,CAAV,CAHA,IAGA,CAAgCG,CAAhC,CAAb,CAEAkB,UAAU,CAAC,UAAW,CAClBjB,CAAC,CAAC,wBAAD,CAAD,CAA4BkB,IAA5B,CAAiC,+BAAjC,EAAkEC,IAAlE,CAAuEX,MAAM,CAACC,SAA9E,CACH,CAFS,CAEP,GAFO,CAGb,CAlBD,EAsBAT,CAAC,CAAC,2CAAD,CAAD,CAA6Ca,EAA7C,CAAgD,OAAhD,CAAyD,UAAW,CAChEL,MAAM,CAACC,SAAP,CAAmB,EAAnB,CAIAF,CAAa,CAACZ,CAAD,CAAUC,CAAV,CAFA,IAEA,CAAgCG,CAAhC,CAAb,CAEAkB,UAAU,CAAC,UAAW,CAClBjB,CAAC,CAAC,iCAAD,CAAD,CAAqCkB,IAArC,CAA0C,+BAA1C,EAA2EC,IAA3E,CAAgFX,MAAM,CAACC,SAAvF,CACH,CAFS,CAEP,GAFO,CAGb,CAVD,EAaAT,CAAC,CAACwB,QAAD,CAAD,CAAYX,EAAZ,CAAe,OAAf,CAAwB,sBAAxB,CAAgD,UAAW,IACnDC,CAAAA,CAAM,CAAGd,CAAC,CAAC,IAAD,CAAD,CAAQe,OAAR,CAAgB,wBAAhB,CAD0C,CAEnDlB,CAAM,CAAGG,CAAC,CAACc,CAAD,CAAD,CAAUE,IAAV,CAAe,aAAf,GAAiC,IAFS,CAGnDlB,CAAI,CAAGE,CAAC,CAAC,IAAD,CAAD,CAAQF,IAAR,EAH4C,CAKvD,GAAIa,CAAJ,CAAW,CACPc,YAAY,CAACd,CAAD,CACf,CAEDA,CAAK,CAAGM,UAAU,CAAC,UAAW,CAC3BvB,CAAQ,CAACC,CAAD,CAAUC,CAAV,CAAwBC,CAAxB,CAAgCC,CAAhC,CAAsCC,CAAtC,CACV,CAFiB,CAEf,GAFe,CAGrB,CAZD,CAaH,CAnEA,CAoEJ,CAtEE,CAwEV,CA/HK,CAAN","sourcesContent":["define([], function() {\n    /**\n     * Makes AJAX call to write current text for forum/discussion/post to DB for restoration later on\n     * @param forumid int\n     * @param discussionid int\n     * @param postid int\n     * @param text string\n     * @param userid int\n     */\n    function autoSave(forumid, discussionid, postid, text, userid) {\n        if ((forumid != '' || discussionid != '') && text != '' && userid != '') {\n            $.ajax({\n                url: \"save_post_draft.php\",\n                method: \"POST\",\n                data: {\n                    forumid: forumid,\n                    discussionid: discussionid,\n                    postid: postid,\n                    text: text,\n                    userid: userid\n                },\n                dataType: \"text\",\n                success: function() {\n                    // Do nothing, write-only call\n                }\n            });\n        }\n    }\n\n    /**\n     * Makes AJAX call to restore draft if it exists\n     * @param forumid\n     * @param discussionid\n     * @param postid\n     * @param userid\n     */\n    function fetchAutoSave(forumid, discussionid, postid, userid) {\n        if ((forumid != '' || discussionid != '' || postid != '') && userid != '') {\n            $.ajax({\n                url: \"get_post_draft.php\",\n                method: \"GET\",\n                data: {\n                    forumid: forumid,\n                    discussionid: discussionid,\n                    postid: postid,\n                    userid: userid\n                },\n                dataType: \"text\",\n                success: function(data) {\n                    window.drafttext = data;\n                }\n            });\n        }\n    }\n\n    return {\n        init: function(forumid, discussionid, userid) {\n            $(function() {\n                let timer;\n                // This is to restore the draft when the page loads and programatic click occurs\n                let pageloadclick = false;\n\n                // Bind click to the reply\n                $('.hsuforum-reply-link').on('click', function() {\n                    window.drafttext = '';\n\n                    let parent = $(this).closest('.hsuforum-post-wrapper');\n                    let postid = $(parent).attr('data-postid');\n\n                    fetchAutoSave(forumid, discussionid, postid, userid);\n\n                    setTimeout(function() {\n                        $(parent).find('#hiddenadvancededitoreditable').html(window.drafttext);\n                    }, 1000);\n                });\n\n                $('.hsuforum-footer-reply .hsuforum-use-advanced').not('.hideadvancededitor').on('click', function(e) {\n                    // Because we toggle editors programmatically depending on how the users interact with the forum, we\n                    // need to differentiate between programmatic clicks after the initial page load click and genuine\n                    // user interactions. If programmatic after page load, prevent any further execution\n                    if (!e.hasOwnProperty('originalEvent') && pageloadclick) {\n                        e.preventDefault();\n                        return false;\n                    }\n\n                    window.drafttext = '';\n                    let postid = null;\n                    pageloadclick = true;\n\n                    fetchAutoSave(forumid, discussionid, postid, userid);\n\n                    setTimeout(function() {\n                        $('.hsuforum-footer-reply').find('#hiddenadvancededitoreditable').html(window.drafttext);\n                    }, 1000);\n                });\n\n\n                // Bind click to new discussion topic button\n                $('#newdiscussionform input[type=\"submit\"]').on('click', function() {\n                    window.drafttext = '';\n\n                    let postid = null;\n\n                    fetchAutoSave(forumid, discussionid, postid, userid);\n\n                    setTimeout(function() {\n                        $('.hsuforum-add-discussion-target').find('#hiddenadvancededitoreditable').html(window.drafttext);\n                    }, 1000);\n                });\n\n                // Bind to keyup to trigger autosave\n                $(document).on(\"keyup\", \".editor_atto_content\", function() {\n                    let parent = $(this).closest('.hsuforum-post-wrapper');\n                    let postid = $(parent).attr('data-postid') || null;\n                    let text = $(this).text();\n\n                    if (timer) {\n                        clearTimeout(timer);\n                    }\n\n                    timer = setTimeout(function() {\n                       autoSave(forumid, discussionid, postid, text, userid);\n                    }, 5000); // Wait 5000 milliseconds before triggering event.\n                });\n            });\n        }\n    };\n});\n"],"file":"mod_hsuforum_save_draft.min.js"}