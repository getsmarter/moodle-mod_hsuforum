define ("mod_hsuforum/mod_hsuforum_loader",["jquery"],function(a){function b(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,c=new Date().getTime();return new Promise(function(d,e){var f=setInterval(function(){var g=new Date().getTime();if(document.querySelector(a)){clearInterval(f);d()}else if(b&&g-c>=b){clearInterval(f);e()}},100)})}registerPostsObserver=function registerPostsObserver(){var b=a(".hsuforum-post-wrapper"),c=a(".hsuforum-footer-reply")[0];if(c!=void 0){b.push(c)}if(b){a(b).each(function(){var b=this,c=new MutationObserver(function(){var c=a(b).find("form");if(c){var d=a(c).find(".hsuforum-textarea");a(c).on("submit",function(){if(0!=a(d).text()){document.body.dispatchEvent(spinnerStartEvent)}})}});c.observe(this,{subtree:!0,childList:!0})})}};a("select.postratingmenu.ratinginput").change(function(){a(this).closest(".hsuforum-post-wrapper").find("span.hsuforum-unreadcount").hide()});var c=a("article").attr("data-postid"),d=a("article").attr("data-discussionid");a.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);if(b){return b[1]||0}};a(".posting a").click(function(){if("@all"===a(this).text()){var b=a(this).attr("href").match(/course=([0-9]+)/)[1];window.open("/blocks/hsuforum_users/forumusers.php?courseid="+b+"&discussion="+d+"&reply="+c,"_blank")}});startSpinnerHandler=function startSpinnerHandler(){a("#hsuforum-overlay-box").show();a("#hsuforum-loading-container").show()};stopSpinnerHandler=function stopSpinnerHandler(){a("#hsuforum-overlay-box").hide();a("#hsuforum-loading-container").hide()};registerSpinnerEvents=function registerSpinnerEvents(){var a=new Event("spinnerStartEvent"),b=new Event("spinnerStopEvent");window.spinnerStartEvent=a;window.spinnerStopEvent=b;document.body.addEventListener("spinnerStartEvent",function(){startSpinnerHandler()});document.body.addEventListener("spinnerStopEvent",function(){stopSpinnerHandler()})};return{init:function init(){b("body",3e4).then(function(){a(".container :input").prop("disabled",!1);a(".mod-hsuforum-posts-container").show();a("#hsuforum-loading-container").hide();a("#hsuforum-overlay-box").hide();window.hascompleted=!1;var b=window.location.hash;if(!window.hascompleted){if(b){if(0<a(b).closest("li").data("depth")){a(b).closest(".posts-collapse-container").addClass("show").find(".posts-collapse-toggle.collapse-bottom").attr("aria-expanded","true")}a("html,body").animate({scrollTop:a(b).offset().top-60},1e3)}window.hascompleted=!0}}).catch(function(){a(".container :input").prop("disabled",!1);a(".article").show();a("#hsuforum-loading-container").hide();a("#hsuforum-overlay-box").hide();throw"element did not load in 30 seconds"});registerPostsObserver();registerSpinnerEvents()}}});
//# sourceMappingURL=mod_hsuforum_loader.min.js.map
