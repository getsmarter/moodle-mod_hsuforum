define(["jquery"],function(t){var e={};return e.init=function(){var e=t(".hsuforum-thread").attr("data-discussionid");function o(e){t.ajax({dataType:"json",url:"/mod/hsuforum/action_handler.php",data:"d="+e+"&action=like&type=get",success:function(t){t.result?d(t.content):window.alert(t.content)}})}e&&o(e);var i,s,a;function d(o){for(var i in o){t("#p"+o[i].id+"actions").remove(),t("div#p"+o[i].id).children(".hsuforum-post-body").append(o[i].actionHTML),t("article#p"+o[i].id).children("header").append(o[i].actionHTML),t("div#p"+o[i].id).children(".hsuforum-post-body").find(".permalink").remove();var s=window.location.protocol+"//"+window.location.hostname+window.location.pathname+"?d="+e+"&postid="+o[i].id;t("div#p"+o[i].id).children(".hsuforum-post-body").children(".hsuforum-tools").find(".hsuforum-thread-tools_list").append('<a class="permalink dropdown-item" href="'+s+'" onclick="M.local_hsuforum_actions.showPermalinkModal(\'#p'+o[i].id+'\');" title="'+s+'"><i class="fa fa-link"></i> Share</a>')}t("a.other-users-link").on("click",function(){t(this).parent().hasClass("like")?(t(this).closest("header").children(".hsuforum-thread-header").length?t("#otherUsersModal").find(".modal-title").text(t(this).closest("header").find(".hsuforum-thread-title h4").text()):t("#otherUsersModal").find(".modal-title").text(t(this).parents(".hsuforum-post-body").find(".hsuforum-post-title").text()),t("#otherUsersModal").find(".no-overflow").html("<p>Other people that like this post:</p>"+t(this).next(".other-users").html()),t("#otherUsersModal").modal("show")):t(this).parent().hasClass("thanks")&&(t(this).closest("header").children(".hsuforum-thread-header").length?t("#otherUsersModal").find(".modal-title").text(t(this).closest("header").find(".hsuforum-thread-title h4").text()):t("#otherUsersModal").find(".modal-title").text(t(this).parents(".hsuforum-post-body").find(".hsuforum-post-title").text()),t("#otherUsersModal").find(".no-overflow").html("<p>Other people that said thanks:</p>"+t(this).next(".other-users").html()),t("#otherUsersModal").modal("show"))});let a=function(t,e,o){for(var i=(e.length?e:window.location.search).split("?")[1].split("&"),s=!0,a=0;a<i.length;a++){let e=i[a].split("=");if(e[0]==t)return o?decodeURIComponent(e[1]):e[1];s=!1}if(!s)return!1}("postid",window.location.hash,!0);0!=a&&t(document).ready(function(){setTimeout(function(){a&&(t("#p"+a).closest(".posts-collapse-container").addClass("show").find(".posts-collapse-toggle.collapse-bottom").attr("aria-expanded","true"),t("html,body").animate({scrollTop:t("#p"+a).parent().offset().top-60},1e3),t(".posts-collapse-container").on("hide.bs.collapse",function(){let e=t(this)[0].id;if(void 0!==e){let o=t(`.collapse-top[data-target="#${e}"]`),i=t(o)[0].parentElement;if(void 0!==i){if(i.getBoundingClientRect().y<0){t(this).parent().attr("id");t("#"+e).on("hidden.bs.collapse",function(){let o=t("#p"+e).offset().top-80;t([document.documentElement,document.body]).animate({scrollTop:o},1e3)})}}}})),document.body.dispatchEvent(spinnerStopEvent),registerPostsObserver()},1e3)})}t("div[role=main]").append('<div id="permalinkModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">    <div class="modal-dialog" id="yui_3_15_0_3_1401116508872_273">        <div class="modal-content" id="yui_3_15_0_3_1401116508872_272">            <div class="modal-header" id="yui_3_15_0_3_1401116508872_271">                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="yui_3_15_0_3_1401116508872_270"> × </button>                <h4 class="modal-title">Permalink</h4>            </div>            <div class="modal-body" style="max-height: 420px;">                <div class="no-overflow">                </div>            </div>            <div class="modal-footer">                <input type="submit" value="Close" class="btn btn-default" data-dismiss="modal" />            </div>        </div>    </div></div>'),t("div[role=main]").append('<div id="otherUsersModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">    <div class="modal-dialog" id="yui_3_15_0_3_1401116508872_273">        <div class="modal-content" id="yui_3_15_0_3_1401116508872_272">            <div class="modal-header" id="yui_3_15_0_3_1401116508872_271">                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="yui_3_15_0_3_1401116508872_270"> × </button>                <h4 class="modal-title">Permalink</h4>            </div>            <div class="modal-body" style="max-height: 420px;">                <div class="no-overflow">                </div>            </div>            <div class="modal-footer">                <input type="submit" value="Close" class="btn btn-default" data-dismiss="modal" />            </div>        </div>    </div></div>'),t("a.other-users-link").on("click",function(){t(this).parent().hasClass("like")&&(t("#otherUsersModal").find(".modal-title").text("People who liked this post: "+t(this).parents(".hsuforum-post-body").find(".hsuforum-post-title").text()),t("#otherUsersModal").find(".no-overflow").html(t(this).find(".other-users").html()),t("#otherUsersModal").modal("show"))}),document.addEventListener("DOMSubtreeModified",(i=function(){t(".actions").length||(e=t(".hsuforum-thread").attr("data-discussionid"))&&o(e)},s=50,a=0,function(){var t=arguments,e=this;clearTimeout(a),a=setTimeout(function(){i.apply(e,t)},s)}),!1)},e.showPermalinkModal=function(e){var o="<p>Copy the following URL to link to this post.</p>";o+='<input type="text" style="width:500px;" onClick="this.select();" value="'+t(e).children(".hsuforum-post-body").find(".permalink").attr("title")+'">',t("#permalinkModal").find(".modal-title").text(t(e).children(".hsuforum-post-body").find(".hsuforum-post-title").text()),t("#permalinkModal").find(".no-overflow").html(o),t("#permalinkModal").modal("show")},e.action=function(t,e){"like"==t?like(e):"unlike"==t&&unlike(e)},like=function(e){t.ajax({dataType:"json",url:"/mod/hsuforum/action_handler.php",data:"p="+e+"&action=like&type=add",success:function(t){if(1==t.result){let t=document.getElementById("like-"+e),o=document.getElementById("like-action-"+e),i=document.getElementById("p"+e+"actions");t.classList.contains("fa-thumbs-up")&&(t.classList.remove("fa-thumbs-up"),t.classList.add("fa-thumbs-down"),o.href="javascript:M.local_hsuforum_actions.action(`unlike`,"+e+");",i.innerHTML='<div class="alert alert-info like">You like this</div>'),document.body.dispatchEvent(spinnerStopEvent)}else document.body.dispatchEvent(spinnerStopEvent)}})},unlike=function(e){t.ajax({dataType:"json",url:"/mod/hsuforum/action_handler.php",data:"p="+e+"&action=like&type=remove",success:function(t){if(1==t.result){let t=document.getElementById("like-"+e),o=document.getElementById("like-action-"+e),i=document.getElementById("p"+e+"actions");t.classList.contains("fa-thumbs-down")&&(t.classList.remove("fa-thumbs-down"),t.classList.add("fa-thumbs-up"),o.href="javascript:M.local_hsuforum_actions.action(`like`,"+e+");",i.innerHTML=""),document.body.dispatchEvent(spinnerStopEvent)}else document.body.dispatchEvent(spinnerStopEvent)}})},window.M.local_hsuforum_actions=e,e});